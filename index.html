<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
	    <meta http-equiv="Pragma" content="no-cache">
	    <meta http-equiv="Expires" content="0">
	    <title>Ahmad IDE</title>
	    <link rel="stylesheet" href="./styles/base.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/context-menu.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/layout.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/project-tree.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/tabs.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/toolbar.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/panels-terminal.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/debug-problems.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/search.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/connections.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/git.css?v=20251209-performance">
	    <link rel="stylesheet" href="./styles/extensions.css?v=20251209-performance">
	</head>

<body>
    <div class="app-shell">
        <header class="menu-bar">
            <div class="menu-left">
                <div class="brand">
                    <div class="brand-icon">üõ∞Ô∏è</div>
                    <div class="brand-meta">
                        <div class="brand-name">Ahmad IDE</div>
                        <div class="brand-sub">PhpStorm Brown</div>
                    </div>
                </div>
                <nav class="menu-cluster" id="mainMenu"></nav>
            </div>
            <div class="menu-right"></div>
        </header>
        <div class="header-toolbar">
            <div class="toolbar-section toolbar-left">
                <div class="toolbar-group">
                    <button class="btn ghost icon-btn toolbar-btn" id="saveRoutineBtn" title="Save (Ctrl+S)">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M13.5 1h-11C1.7 1 1 1.7 1 2.5v11c0 .8.7 1.5 1.5 1.5h11c.8 0 1.5-.7 1.5-1.5v-11c0-.8-.7-1.5-1.5-1.5zM11 2v4H5V2h6zm2 11.5c0 .3-.2.5-.5.5h-9c-.3 0-.5-.2-.5-.5v-9c0-.3.2-.5.5-.5H4v5h8V4h.5c.3 0 .5.2.5.5v9z" />
                            <circle cx="8" cy="10" r="1.5" />
                        </svg>
                        <span class="btn-label">Save</span>
                    </button>
                </div>
                <div class="toolbar-group run-debug-widget">
                    <button class="btn ghost icon-btn toolbar-btn" id="lintBtn" title="Lint Code">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M8 1l-1.5 1.5L8 4 9.5 2.5 8 1zM3.5 3.5L2 5l1.5 1.5L5 5 3.5 3.5zm9 0L11 5l1.5 1.5L14 5l-1.5-1.5zM8 5c-1.7 0-3 1.3-3 3v5h6V8c0-1.7-1.3-3-3-3zm0 2c.6 0 1 .4 1 1v3H7V8c0-.6.4-1 1-1z" />
                        </svg>
                    </button>
                    <button class="btn primary icon-btn toolbar-btn run-btn" id="runBtn" title="Run (Ctrl+Enter)">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M4 2v12l10-6L4 2z" />
                        </svg>
                        <span class="btn-label">Run</span>
                    </button>
                    <button class="btn ghost icon-btn toolbar-btn" id="debugStartBtn" title="Debug (Shift+F9)">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M8 2C6.3 2 5 3.3 5 5v1H3v2h2v1c0 .7.2 1.3.6 1.9L4 12.5l1.4 1.4L7 12.3c.6.4 1.3.7 2 .7s1.4-.2 2-.7l1.6 1.6 1.4-1.4-1.6-1.6c.4-.5.6-1.2.6-1.9V8h2V6h-2V5c0-1.7-1.3-3-3-3zm0 2c.6 0 1 .4 1 1v5c0 .6-.4 1-1 1s-1-.4-1-1V5c0-.6.4-1 1-1z" />
                        </svg>
                        <span class="btn-label">Debug</span>
                    </button>
                    <div class="run-config-control">
                        <button class="btn ghost icon-btn toolbar-btn dropdown-btn" id="runConfigBtn"
                            title="Run/Debug configurations" aria-label="Run/Debug configurations">
                            <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M4 6l4 4 4-4H4z" />
                            </svg>
                        </button>
                        <div class="run-config-menu hidden" id="runConfigMenu">
                            <div class="run-config-header">Run Configurations</div>
                            <button class="run-config-item" data-config="run-current">Current file (Run)</button>
                            <button class="run-config-item" data-config="debug-current">Current file (Debug)</button>
                            <div class="run-config-separator"></div>
                            <div class="run-config-item disabled">NOT IMPLEMENTED YET: custom configurations</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="toolbar-section toolbar-right">
                <div class="vcs-widget" id="vcsWidget">
                    <button class="btn ghost icon-btn toolbar-btn vcs-toggle" id="vcsWidgetBtn" title="Git"
                        aria-label="Git">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <circle cx="4" cy="4" r="2" />
                            <circle cx="12" cy="12" r="2" />
                            <path d="M5.5 5.5l5 5" stroke="currentColor" stroke-width="1.8" fill="none" />
                        </svg>
                        <svg class="chevron-icon" width="12" height="12" viewBox="0 0 16 16" fill="none"
                            stroke="currentColor" stroke-width="1.4">
                            <path d="M4 6l4 4 4-4" />
                        </svg>
                    </button>
                    <div class="vcs-menu hidden" id="vcsWidgetMenu">
                        <button class="vcs-menu-item" data-action="commit">Commit‚Ä¶</button>
                        <button class="vcs-menu-item" data-action="history">Show History</button>
                        <button class="vcs-menu-item" data-action="push">Push</button>
                        <button class="vcs-menu-item" data-action="pull">Pull / Fetch</button>
                        <div class="vcs-menu-separator"></div>
                        <button class="vcs-menu-item" data-action="open-git">Open Git Tool Window</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- PhpStorm-style main body with tool window bars -->
        <div class="ide-body">
            <!-- LEFT TOOL WINDOW BAR (PhpStorm: Project, Structure, Bookmarks) -->
            <div class="tool-window-bar tool-window-bar-left">
                <button class="tool-window-stripe-btn active" data-panel="projectPanel" data-position="left"
                    title="Project (Alt+1)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2 2h5l2 2h5v10H2V2zm1 1v10h10V5H8.5L6.5 3H3z" />
                    </svg>
                    <span class="stripe-text">Project</span>
                </button>
                <button class="tool-window-stripe-btn" data-panel="structurePanel" data-position="left"
                    title="Structure (Alt+7)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2 3h12v2H2zM4 7h10v2H4zM4 11h10v2H4z" />
                    </svg>
                    <span class="stripe-text">Structure</span>
                </button>
                <div class="stripe-spacer"></div>
            </div>

            <!-- LEFT TOOL WINDOW CONTENT -->
            <aside class="tool-window-content tool-window-left" id="leftToolWindow">
                <!-- Project Panel -->
                <div class="tool-window-panel" id="projectPanel">
                    <div class="tool-window-header">
                        <span class="tool-window-title">Project</span>
                        <div class="tool-window-actions">
                            <button class="tool-window-action-btn" id="collapseAllBtn" title="Collapse All">
                                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M4 6l4 4 4-4H4z" />
                                </svg>
                            </button>
                            <button class="tool-window-action-btn" id="hideProjectBtn" title="Hide">
                                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" fill="none" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <input class="filter-input" id="routineFilterInput" placeholder="Filter...">
                    <div class="project-tree" id="projectTree"></div>
                </div>
                <!-- Structure Panel -->
                <div class="tool-window-panel hidden" id="structurePanel">
                    <div class="tool-window-header">
                        <span class="tool-window-title">Structure</span>
                        <div class="tool-window-actions">
                            <button class="tool-window-action-btn hide-panel-btn" title="Hide">
                                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" fill="none" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="tool-window-body">
                        <div class="placeholder-content">TODO: Structure tool window content</div>
                    </div>
                </div>
            </aside>

            <!-- CENTER: Editor only (bottom panels moved outside) -->
            <div class="ide-center">
                <!-- Editor Area -->
                <main class="editor-area">
                    <div class="tabbar">
                        <div id="tabBar" class="tab-container"></div>
                    </div>
                    <div class="action-bar">
                        <div class="crumbs" id="breadcrumbs">
                            <span class="breadcrumb-item">Project</span>
                        </div>
                        <div class="actions"></div>
                    </div>
                    <div class="editor-frame">
                        <div id="editor"></div>
                    </div>
                </main>
            </div>
        </div>

        <!-- BOTTOM TOOL WINDOW (spans FULL width like PhpStorm) -->
        <div class="bottom-bar-wrapper" id="bottomBarWrapper">
            <div class="tool-window-bar tool-window-bar-bottom">
                <button class="tool-window-stripe-btn horizontal active" data-panel="terminalPanel"
                    data-position="bottom" title="Terminal (Alt+F12)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2 3v10h12V3H2zm10 8H4V5h8v6z" />
                        <path d="M5 7l2 1.5L5 10" stroke="currentColor" fill="none" stroke-width="1.2" />
                        <path d="M8 9h2" stroke="currentColor" stroke-width="1.2" />
                    </svg>
                    <span class="stripe-text">Terminal</span>
                </button>
                <button class="tool-window-stripe-btn horizontal" data-panel="debugPanel" data-position="bottom"
                    title="Debug (Alt+5)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <circle cx="8" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5" />
                        <path d="M8 2v2M8 12v2M2 8h2M12 8h2" stroke="currentColor" stroke-width="1.2" />
                    </svg>
                    <span class="stripe-text">Debug</span>
                </button>
                <button class="tool-window-stripe-btn horizontal" data-panel="problemsPanel" data-position="bottom"
                    title="Problems (Alt+6)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 2l6 12H2L8 2z" />
                        <path d="M8 6v4" stroke="#2b2b2b" stroke-width="1.2" />
                        <circle cx="8" cy="12" r="0.8" fill="#2b2b2b" />
                    </svg>
                    <span class="stripe-text">Problems</span>
                </button>
                <div class="stripe-spacer"></div>
                <button class="tool-window-stripe-btn horizontal" data-panel="extensionsPanel" data-position="bottom"
                    title="Extensions (Alt+E)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="2" y="2" width="12" height="12" rx="3" fill="none" stroke="currentColor"
                            stroke-width="1.2" />
                        <path d="M5 5h6v2H5zM5 9h6v2H5z" fill="currentColor" />
                    </svg>
                    <span class="stripe-text">Extensions</span>
                </button>
                <button class="tool-window-stripe-btn horizontal" data-panel="servicesPanel" data-position="bottom"
                    title="Services (Alt+8)">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="2" y="5" width="12" height="7" rx="1" fill="none" stroke="currentColor"
                            stroke-width="1.5" />
                        <path d="M6 3h4v2H6z" />
                    </svg>
                    <span class="stripe-text">Services</span>
                </button>
            </div>
            <div class="tool-window-content tool-window-bottom" id="bottomToolWindow">
                <div class="bottom-panels-container">
                    <section class="panel terminal" id="terminalPanel">
                        <div class="pane-header terminal-header">
                            <div class="pane-title">Terminal</div>
                            <div class="pane-actions">
                                <div class="pill subtle" id="terminalStatusPill" title="Toggle with Alt+F12">Alt+F12
                                </div>
                                <button class="btn ghost icon-btn" id="terminalNewTabBtn"
                                    title="New Terminal Tab (Ctrl+Shift+T)">+</button>
                                <button class="btn ghost icon-btn" id="terminalHideBtn" title="Hide Terminal">‚úï</button>
                            </div>
                        </div>
                        <div class="terminal-tabbar">
                            <div id="terminalTabs" class="terminal-tabs"></div>
                            <div class="terminal-tab-actions">
                                <button class="btn ghost icon-btn" id="terminalClearBtn"
                                    title="Clear Active Terminal">Clear</button>
                            </div>
                        </div>
                        <div class="terminal-surface">
                            <div class="terminal-viewport" id="terminalViewport" aria-label="Terminal"></div>
                            <div class="terminal-error hidden" id="terminalError" role="alert"></div>
                        </div>
                    </section>
                    <section class="panel debug-panel" id="debugPanel">
                        <div class="pane-header">
                            <div class="pane-title">Debug</div>
                            <div class="pill subtle">Breakpoints / Locals / Stack / Output</div>
                            <div class="pane-subtitle">Tip: while paused, hover variables in the editor to see their
                                values.</div>
                        </div>
                        <div class="debug-tabs">
                            <div class="debug-tab active" data-tab="tab-breakpoints">Breakpoints</div>
                            <div class="debug-tab" data-tab="tab-variables">Variables</div>
                            <div class="debug-tab" data-tab="tab-watches">Watches</div>
                            <div class="debug-tab" data-tab="tab-stack">Call Stack</div>
                            <div class="debug-tab" data-tab="tab-console">Console</div>
                            <div class="debug-tab" data-tab="tab-problems">Problems</div>
                        </div>
                        <div class="debug-tabpanes">
                            <div class="debug-tabpane active" id="tab-breakpoints">
                                <div class="bp-action-row">
                                    <button class="btn ghost" id="bpClearAllBtn">Clear All</button>
                                </div>
                                <ul class="problems-list" id="breakpointsList"></ul>
                            </div>
                            <div class="debug-tabpane" id="tab-variables">
                                <ul class="problems-list" id="localsList"></ul>
                            </div>
                            <div class="debug-tabpane" id="tab-watches">
                                <div class="pane-subtitle">Watches not implemented.</div>
                            </div>
                            <div class="debug-tabpane" id="tab-stack">
                                <ul class="problems-list" id="stackList"></ul>
                            </div>
                            <div class="debug-tabpane" id="tab-console">
                                <pre class="debug-output" id="debugOutput"></pre>
                            </div>
                            <div class="debug-tabpane" id="tab-problems">
                                <ul class="problems-list" id="problemsList"></ul>
                            </div>
                        </div>
                    </section>
                    <section class="panel debug-panel hidden" id="problemsPanel">
                        <div class="pane-header">
                            <div class="pane-title">Problems</div>
                            <div class="pill subtle">Diagnostics</div>
                        </div>
                        <ul class="problems-list" id="problemsListStandalone"></ul>
                    </section>
                    <section class="panel debug-panel hidden" id="gitToolPanel">
                        <div class="pane-header">
                            <div class="pane-title">Git</div>
                            <div class="pill subtle">Status / Log / Diff</div>
                        </div>
                        <div class="git-grid">
                            <div class="git-left">
                                <div class="pane-title">Local Changes</div>
                                <div class="pane-subtitle">Unstaged</div>
                                <div class="git-changes-list" id="gitChangesUnstaged">Run status to load changes.</div>
                                <div class="pane-subtitle" style="margin-top:6px;">Staged</div>
                                <div class="git-changes-list" id="gitChangesStaged">No staged files.</div>
                                <div class="flex git-actions" style="margin-top:8px;">
                                    <button class="btn ghost" id="gitRefreshBtn">Refresh</button>
                                    <button class="btn ghost" id="gitStageSelectedBtn">Stage</button>
                                    <button class="btn ghost" id="gitUnstageSelectedBtn">Unstage</button>
                                    <button class="btn ghost" id="gitDiffSelectedBtn">Diff Selected</button>
                                </div>
                                <div class="pane-title" style="margin-top:10px;">Commit</div>
                                <textarea id="gitCommitMessage" class="git-commit-input"
                                    placeholder="Commit message"></textarea>
                                <div class="flex git-actions">
                                    <button class="btn primary" id="gitCommitBtn">Commit</button>
                                    <button class="btn ghost" id="gitPushBtn">Push</button>
                                    <button class="btn ghost" id="gitPullBtn">Pull</button>
                                    <button class="btn ghost" id="gitFetchBtn">Fetch</button>
                                </div>
                                <div class="pane-title" style="margin-top:6px;">Branch</div>
                                <div class="git-branch-row">
                                    <select id="gitBranchSelect" class="git-branch-select"></select>
                                    <input id="gitBranchInput" class="git-branch-input" placeholder="New branch name">
                                    <button class="btn ghost" id="gitCheckoutBtn">Checkout</button>
                                </div>
                            </div>
                            <div class="git-right">
                                <div class="pane-title">History</div>
                                <div class="flex" style="margin-bottom:6px; flex-wrap: wrap;">
                                    <button class="btn ghost" id="gitStatusBtn">Status</button>
                                    <button class="btn ghost" id="gitLogBtn">Log</button>
                                    <button class="btn ghost" id="gitDiffBtn">Diff (stat)</button>
                                    <button class="btn ghost" id="gitClearBtn">Clear</button>
                                </div>
                                <div class="git-history-list" id="gitHistoryList">History not loaded.</div>
                                <div class="pane-title" style="margin-top:8px;">Console</div>
                                <pre class="debug-output" id="gitOutput">Git ready.</pre>
                                <div class="pane-title" style="margin-top:8px;">File Diff</div>
                                <div class="flex" style="gap:6px; margin-bottom:6px;">
                                    <input class="ssh-input" id="gitDiffPath" placeholder="Path (relative)">
                                    <button class="btn ghost" id="gitDiffFileBtn">Show Diff</button>
                                    <button class="btn ghost" id="gitHistoryFileBtn">File History</button>
                                </div>
                                <div class="pane-title" style="margin-top:6px;">Compare Two Files</div>
                                <div class="flex" style="gap:6px; margin-bottom:6px;">
                                    <input class="ssh-input" id="gitComparePathA" placeholder="Path A">
                                    <input class="ssh-input" id="gitComparePathB" placeholder="Path B">
                                    <button class="btn ghost" id="gitCompareBtn">Compare</button>
                                </div>
                                <div class="git-diff-grid">
                                    <pre class="debug-output" id="gitDiffLeft">Left</pre>
                                    <pre class="debug-output" id="gitDiffRight">Right</pre>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section class="panel debug-panel hidden" id="extensionsPanel">
                        <div class="pane-header">
                            <div class="pane-title">Extensions</div>
                            <div class="pill subtle">Plugins / Add-ons</div>
                        </div>
                        <div class="extensions-grid">
                            <div class="extensions-list" id="extensionsList">Loading extensions...</div>
                            <div class="extensions-detail" id="extensionDetail">
                                <div class="pane-title">Select an extension</div>
                                <div class="pane-subtitle">Details will appear here.</div>
                            </div>
                        </div>
                    </section>
                    <section class="panel debug-panel hidden" id="servicesPanel">
                        <div class="pane-header">
                            <div class="pane-title">Services</div>
                            <div class="pill subtle">Docker / SSH</div>
                        </div>
                        <div class="pane-title">Docker</div>
                        <div class="pane-subtitle">List running containers</div>
                        <div class="flex" style="margin-bottom:6px;">
                            <button class="btn ghost" id="svcDockerListBtn">List Containers</button>
                            <button class="btn ghost" id="svcDockerRefreshBtn">Refresh</button>
                        </div>
                        <div class="git-changes-list" id="svcDockerOutput">Docker services not queried.</div>
                        <div class="pane-title" style="margin-top:10px;">SSH</div>
                        <div class="pane-subtitle">Run simple command</div>
                        <div class="flex" style="gap:6px; margin-bottom:6px;">
                            <input class="ssh-input" id="svcSshCmd" placeholder="Command (requires SSH config)">
                            <button class="btn ghost" id="svcSshRunBtn">Run</button>
                        </div>
                        <div class="git-changes-list" id="svcSshOutput">SSH services not queried.</div>
                    </section>
                </div>
                <!-- BOTTOM TOOL WINDOW BAR (PhpStorm: Terminal, Run, Debug, Problems) -->
            </div>
        </div>

        <footer class="statusbar">
            <div class="status-left">
                <span class="status-item" id="gitBranch" title="Git Branch">
                    <span class="icon">‚éá</span> ‚Äî
                </span>
                <span class="status-item" id="problemsSummary" title="Problems">
                    <span class="icon">‚ö†</span> 0
                </span>
            </div>
            <div class="status-right">
                <span class="status-item" id="lineColInfo" title="Line:Column">Ln 1, Col 1</span>
                <span class="status-item" id="currentRoutineLabel" title="Current File">main.m</span>
                <span class="status-item" id="fileLanguage" title="Language">MUMPS</span>
                <span class="status-item" id="fileEncoding" title="Encoding">UTF-8</span>
                <span class="status-item" id="lineEndings" title="Line Endings">LF</span>
                <span class="status-item" id="toggleConnections" title="Open Connections panel">Connections</span>
                <span class="status-item status-pill"><span class="pill subtle" id="connStatus">Ready</span></span>
                <span class="status-item" id="envInfo">Loading...</span>
            </div>
        </footer>
    </div>

    <!-- Connections panel -->
    <div id="connectionsOverlay" class="connections-overlay hidden"></div>
    <div id="connectionsPanel" class="connections-panel hidden">
        <div class="connections-header">
            <div>
                <div class="pane-title">Connections</div>
                <div class="pane-subtitle">Switch between Docker and SSH</div>
            </div>
            <button class="btn ghost icon-btn" id="closeConnectionsBtn" title="Close">‚úï</button>
        </div>
        <div class="connections-grid">
            <div class="connection-card">
                <div class="panel-title">Docker</div>
                <div class="pane-subtitle">Pick a running container</div>
                <div id="dockerList" class="list docker-list"></div>
                <div class="flex">
                    <button class="btn ghost" id="refreshDockerBtn">Refresh Docker</button>
                    <button class="btn ghost" id="useLocalDockerBtn">Use Default</button>
                </div>
            </div>
            <div class="connection-card">
                <div class="panel-title">SSH</div>
                <div class="pane-subtitle">Connect to a remote host</div>
                <div class="ssh-form">
                    <input class="ssh-input" id="sshHostInput" placeholder="Host (e.g., 10.0.0.5)">
                    <input class="ssh-input" id="sshPortInput" placeholder="Port (default 22)" type="number" min="1"
                        max="65535">
                    <input class="ssh-input" id="sshEnvInput" placeholder="Environment key (e.g., cc)">
                    <input class="ssh-input" id="sshUserInput" placeholder="Username">
                    <input class="ssh-input" id="sshPassInput" placeholder="Password" type="password">
                    <button class="btn primary" id="sshConnectBtn">Connect SSH</button>
                </div>
                <div class="pill subtle" id="sshFormStatus">Not connected</div>
                <div class="ssh-saved">
                    <div class="pane-subtitle">Saved environments</div>
                    <div id="sshSavedList" class="saved-env-list"></div>
                    <div class="flex">
                        <button class="btn ghost" id="sshSaveEnvBtn">Save environment</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shortcuts panel -->
    <div id="shortcutsOverlay" class="connections-overlay hidden"></div>
    <div id="shortcutsPanel" class="connections-panel hidden">
        <div class="connections-header">
            <div>
                <div class="pane-title">Keyboard Shortcuts</div>
                <div class="pane-subtitle">Current bindings (owner configurable)</div>
            </div>
            <button class="btn ghost icon-btn" id="closeShortcutsBtn" title="Close">‚úï</button>
        </div>
        <div class="connections-grid">
            <div class="connection-card">
                <div class="panel-title">Registered Commands</div>
                <div class="pane-subtitle">Click to copy summary</div>
                <ul class="problems-list" id="shortcutsList"></ul>
                <div class="pane-title" style="margin-top:8px;">Update Binding</div>
                <div class="ssh-form">
                    <select class="ssh-input" id="shortcutSelect">
                        <option value="duplicate-line">Duplicate Line</option>
                        <option value="run-code">Run</option>
                        <option value="lint-code">Lint</option>
                        <option value="toggle-sidebar">Toggle Sidebar</option>
                        <option value="toggle-terminal">Toggle Terminal</option>
                        <option value="new-terminal">New Terminal</option>
                    </select>
                    <input class="ssh-input" id="shortcutInput" placeholder="e.g., Ctrl+D">
                    <button class="btn primary" id="saveShortcutBtn">Save Binding</button>
                </div>
                <div class="pane-subtitle">Valid: Ctrl/Cmd/Shift/Alt + Letter/Enter/F-keys (e.g., Ctrl+Shift+L)</div>
            </div>
        </div>
    </div>

    <!-- Find / Replace in Files (PhpStorm-style) -->
    <div id="findOverlay" class="overlay hidden"></div>
    <div id="findDialog" class="search-dialog hidden" data-mode="find">
        <div class="search-dialog-header">
            <div>
                <div class="pane-title" id="findDialogTitle">Find in Files</div>
                <div class="pane-subtitle" id="findScopeLabel">Scope: Unknown</div>
            </div>
            <div class="dialog-actions">
                <span class="pill subtle" id="findModePill">Find</span>
                <button class="btn ghost icon-btn" id="closeFindDialog" title="Close">‚úï</button>
            </div>
        </div>
        <div class="search-dialog-body">
            <label class="field-label" for="findQueryInput">Text to find</label>
            <input class="search-text-input" id="findQueryInput" placeholder="Search term">
            <div class="replace-row" id="replaceRow">
                <label class="field-label" for="replaceQueryInput">Replace with</label>
                <input class="search-text-input" id="replaceQueryInput" placeholder="Replacement text">
            </div>
            <div class="search-options">
                <label><input type="checkbox" id="findCaseOption"> Case sensitive</label>
                <label><input type="checkbox" id="findWholeOption"> Whole words</label>
                <label><input type="checkbox" id="findRegexOption"> Regex</label>
                <span class="search-scope-pill" id="findScopePath">Scope: Unknown</span>
            </div>
            <div class="search-results-list" id="findResults">Type to search‚Ä¶</div>
            <div class="search-actions">
                <button class="btn ghost" id="findReplaceToggleBtn">Switch to Replace</button>
                <button class="btn primary" id="replaceAllBtn">Replace All</button>
            </div>
        </div>
    </div>

    <!-- Search Everywhere (double Shift) -->
    <div id="searchEverywhereOverlay" class="overlay hidden"></div>
    <div id="searchEverywhereDialog" class="search-everywhere hidden">
        <input class="search-everywhere-input" id="searchEverywhereInput" placeholder="Search Everywhere (files)">
        <div class="search-everywhere-results" id="searchEverywhereResults">Press Shift twice to search‚Ä¶</div>
    </div>

    <!-- Git panel -->
    <div id="gitOverlay" class="connections-overlay hidden"></div>
    <div id="gitPanel" class="connections-panel hidden">
        <div class="connections-header">
            <div>
                <div class="pane-title">Git</div>
                <div class="pane-subtitle">Status / Log / Diff (workspace)</div>
            </div>
            <button class="btn ghost icon-btn" id="closeGitBtn" title="Close">‚úï</button>
        </div>
        <div class="git-grid">
            <div class="git-left">
                <div class="pane-title">Changes</div>
                <div class="pane-subtitle">Modified/Added/Deleted</div>
                <div class="git-changes-list" id="gitChangesList">Run status to load changes.</div>
                <div class="pane-title" style="margin-top:10px;">Commit</div>
                <textarea id="gitCommitMessage" class="git-commit-input" placeholder="Commit message"></textarea>
                <div class="flex git-actions">
                    <button class="btn primary" id="gitCommitBtn">Commit</button>
                    <button class="btn ghost" id="gitPushBtn">Push</button>
                    <button class="btn ghost" id="gitPullBtn">Pull</button>
                    <button class="btn ghost" id="gitFetchBtn">Fetch</button>
                </div>
                <div class="pane-title" style="margin-top:6px;">Branch</div>
                <div class="git-branch-row">
                    <select id="gitBranchSelect" class="git-branch-select"></select>
                    <input id="gitBranchInput" class="git-branch-input" placeholder="New branch name">
                    <button class="btn ghost" id="gitCheckoutBtn">Checkout</button>
                </div>
            </div>
            <div class="git-right">
                <div class="pane-title">History</div>
                <div class="flex" style="margin-bottom:6px;">
                    <button class="btn ghost" id="gitStatusBtn">Status</button>
                    <button class="btn ghost" id="gitLogBtn">Log</button>
                    <button class="btn ghost" id="gitDiffBtn">Diff (stat)</button>
                    <button class="btn ghost" id="gitClearBtn">Clear</button>
                </div>
                <pre class="debug-output" id="gitOutput">Git ready.</pre>
                <div class="pane-title" style="margin-top:8px;">File Diff</div>
                <div class="flex" style="gap:6px; margin-bottom:6px;">
                    <input class="ssh-input" id="gitDiffPath" placeholder="Path (relative)">
                    <button class="btn ghost" id="gitDiffFileBtn">Show Diff</button>
                    <button class="btn ghost" id="gitHistoryFileBtn">File History</button>
                </div>
                <div class="pane-title" style="margin-top:6px;">Compare Two Files</div>
                <div class="flex" style="gap:6px; margin-bottom:6px;">
                    <input class="ssh-input" id="gitComparePathA" placeholder="Path A">
                    <input class="ssh-input" id="gitComparePathB" placeholder="Path B">
                    <button class="btn ghost" id="gitCompareBtn">Compare</button>
                </div>
                <div class="git-diff-grid">
                    <pre class="debug-output" id="gitDiffLeft">Left</pre>
                    <pre class="debug-output" id="gitDiffRight">Right</pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Editor context menu -->
    <div id="editorContextMenu" class="context-menu">
        <div class="ctx-item" data-action="ctx-cut">Cut</div>
        <div class="ctx-item" data-action="ctx-copy">Copy</div>
        <div class="ctx-item" data-action="ctx-paste">Paste</div>
        <div class="ctx-separator"></div>
        <div class="ctx-item" data-action="ctx-format">Format Code</div>
        <div class="ctx-item" data-action="ctx-declare">Go to Declaration</div>
        <div class="ctx-item" data-action="ctx-usages">Find Usages</div>
        <div class="ctx-separator"></div>
        <div class="ctx-item" data-action="ctx-comment">Toggle Comment</div>
        <div class="ctx-separator"></div>
        <div class="ctx-item git-parent" data-action="ctx-git-parent">Git ‚ñ∏
            <div class="context-menu git-submenu">
                <div class="ctx-item" data-action="ctx-git-add">Add</div>
                <div class="ctx-item" data-action="ctx-git-commit-file">Commit‚Ä¶</div>
                <div class="ctx-item" data-action="ctx-git-history">Show History</div>
                <div class="ctx-item" data-action="ctx-git-compare">Compare with Latest Version</div>
                <div class="ctx-item" data-action="ctx-git-rollback">Revert / Rollback</div>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <!-- Settings panel -->
    <div id="settingsOverlay" class="connections-overlay hidden"></div>
    <div id="settingsPanel" class="connections-panel hidden">
        <div class="connections-header">
            <div>
                <div class="pane-title">Settings</div>
                <div class="pane-subtitle">Preferences</div>
            </div>
            <button class="btn ghost icon-btn" id="closeSettingsBtn" title="Close">‚úï</button>
        </div>
        <div class="connections-grid">
            <div class="connection-card">
                <div class="pane-title">Appearance</div>
                <div class="pane-subtitle">IDE & Code themes</div>
                <div class="ssh-form">
                    <label class="pane-subtitle">IDE Theme</label>
                    <select class="ssh-input" id="settingsIdeTheme">
                        <option value="earth">Earth Dark</option>
                        <option value="desert">Desert Contrast</option>
                    </select>
                    <label class="pane-subtitle">Code Theme</label>
                    <select class="ssh-input" id="settingsCodeTheme">
                        <option value="mumps-earth">Earthy</option>
                        <option value="mumps-dark">Carbon</option>
                    </select>
                </div>
            </div>
            <div class="connection-card">
                <div class="pane-title">Git</div>
                <div class="pane-subtitle">Configure author & remote</div>
                <div class="ssh-form">
                    <input class="ssh-input" id="gitUserName" placeholder="User name (git config user.name)">
                    <input class="ssh-input" id="gitUserEmail" placeholder="Email (git config user.email)">
                    <input class="ssh-input" id="gitRemoteUrl" placeholder="Remote URL (origin)">
                    <button class="btn primary" id="gitSettingsSave">Save Git Settings</button>
                    <button class="btn ghost" id="gitSettingsTest">Test Git Status</button>
                </div>
                <div class="pane-subtitle" id="gitSettingsStatus">Not applied</div>
            </div>
            <div class="connection-card">
                <div class="pane-title">Developer Tools</div>
                <div class="pane-subtitle">Debug and inspect IDE</div>
                <button class="btn primary" id="toggleDevTools">Toggle DevTools</button>
            </div>
            <div class="connection-card">
                <div class="pane-title">Terminal</div>
                <div class="pane-subtitle">Shell settings (stub)</div>
            </div>
            <div class="connection-card">
                <div class="pane-title">SSH / Docker</div>
                <div class="pane-subtitle">Configure remotes (stub)</div>
            </div>
        </div>
    </div>

    <!-- New Project panel -->
    <div id="newProjectOverlay" class="connections-overlay hidden"></div>
    <div id="newProjectPanel" class="connections-panel hidden">
        <div class="connections-header">
            <div>
                <div class="pane-title">New Project</div>
                <div class="pane-subtitle">Create web + routines structure</div>
            </div>
            <button class="btn ghost icon-btn" id="closeNewProjectBtn" title="Close">‚úï</button>
        </div>
        <div class="connections-grid">
            <div class="connection-card">
                <div class="panel-title">Project Details</div>
                <div class="pane-subtitle">Name and location</div>
                <div class="ssh-form">
                    <label class="pane-subtitle">Project Name</label>
                    <input class="ssh-input" id="projectName" placeholder="my-project">

                    <label class="pane-subtitle">Project Path (parent directory)</label>
                    <input class="ssh-input" id="projectPath" placeholder="/home/ahmad/projects"
                        value="/home/ahmad/projects">

                    <div class="pane-subtitle" style="margin-top:12px;">
                        <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                            <input type="checkbox" id="fetchRoutines" checked style="cursor:pointer;">
                            Auto-fetch MUMPS routines from Docker (max 100)
                        </label>
                    </div>

                    <button class="btn primary" id="createProjectBtn" style="margin-top:16px;">Create Project</button>
                </div>
                <div class="pill subtle" id="projectCreationStatus">Ready</div>
            </div>

            <div class="connection-card">
                <div class="panel-title">Structure Preview</div>
                <div class="pane-subtitle">Will be created:</div>
                <pre class="debug-output" id="structurePreview" style="font-size:12px; line-height:1.6;">my-project/
‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îî‚îÄ‚îÄ (empty - add your PHP files here)
‚îî‚îÄ‚îÄ routines/
    ‚îî‚îÄ‚îÄ (MUMPS .m files from Docker)</pre>
            </div>
        </div>
    </div>

    <!-- Floating debug bar -->
    <div id="debugBar" class="debug-float hidden">
        <button data-cmd="continue" id="dbgContinueBtn" title="Resume Program (F9)">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="#6a9955">
                <path d="M4 3l9 5-9 5V3z" />
            </svg>
        </button>
        <button data-cmd="pause" id="dbgPauseBtn" title="Pause Program">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M4 3h3v10H4V3zm5 0h3v10H9V3z" />
            </svg>
        </button>
        <button data-cmd="step-over" id="dbgStepOverBtn" title="Step Over (F8)">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path
                    d="M8 4a3 3 0 0 0-3 3v2h2V7a1 1 0 0 1 1-1h1.59l-1.3 1.29 1.42 1.42L13.41 5 9.71 1.29 8.29 2.71 9.59 4H8zM3 13h10v-2H3v2z" />
            </svg>
        </button>
        <button data-cmd="step-into" id="dbgStepIntoBtn" title="Step Into (F7)">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path
                    d="M8 2a1 1 0 0 0-1 1v4H5.5l2.5 2.5 2.5-2.5H9V3a1 1 0 0 0-1-1zM4 14h8a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1z" />
            </svg>
        </button>
        <button data-cmd="step-out" id="dbgStepOutBtn" title="Step Out (Shift+F8)">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path
                    d="M8 10a1 1 0 0 0 1-1V5h1.5L8 2.5 5.5 5H7v4a1 1 0 0 0 1 1zM4 14h8a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1z" />
            </svg>
        </button>
        <button data-cmd="restart" id="dbgRestartBtn" title="Restart Debugger">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="#5fb4b4">
                <path d="M8 3a5 5 0 0 0-4.59 3H2l3 4 3-4H6.06a3.06 3.06 0 1 1 .5 5.23l1.37 1.37A5 5 0 1 0 8 3z" />
            </svg>
        </button>
        <button data-cmd="stop" id="dbgStopBtn" title="Stop Debugger (Ctrl+F2)">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="#f48771">
                <rect x="3" y="3" width="10" height="10" rx="1" />
            </svg>
        </button>
    </div>

    <script src="./libs/jquery.min.js"></script>
    <script src="./assets/mumps/mumps-validator.js"></script>
    <script src="./assets/mumps/mumps-linter.js"></script>
    <script src="./assets/mumps/mumps-lexer.js"></script>
    <!-- AST/parser intentionally not loaded at startup; parser path is disabled in validateMumps -->
    <script src="./utils/debug-log.js"></script>
    <script src="./utils/logger.js"></script>
	    <script src="./src/editor/tabs/renderer-tabs.js"></script>
	    <script src="./src/editor/terminal/renderer-terminal.js"></script>
		    <script src="./src/editor/search/renderer-search.js"></script>
		    <script src="./src/editor/debug/renderer-debug.js"></script>
		    <script src="./src/editor/problems/renderer-problems.js"></script>
			    <script src="./src/editor/diagnostics/renderer-diagnostics.js"></script>
			    <script src="./src/editor/extensions/renderer-extensions.js"></script>
			    <script src="./src/editor/git/renderer-git-toolwindow.js"></script>
			    <script src="./src/editor/git/renderer-git-settings.js"></script>
			    <script src="./src/editor/connections/renderer-connections.js"></script>
			    <script src="./src/editor/project/renderer-project-create.js"></script>
			    <script src="./src/editor/project/renderer-project-context-menu.js"></script>
			    <script src="./src/editor/project/renderer-project-tree.js"></script>
			    <script src="./src/editor/routines/renderer-routines.js"></script>
			    <script src="./src/editor/ui/renderer-editor-context-menu.js"></script>
			    <script src="./src/editor/ui/renderer-settings-panel.js"></script>
			    <script src="./src/editor/ui/renderer-ctrl-hover.js"></script>
			    <script src="./src/editor/mumps/renderer-mumps-monaco.js"></script>
			    <script src="./renderer.js"></script>
			</body>

		</html>
