<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahmad IDE</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
<div class="app-shell">
    <header class="menu-bar">
        <div class="menu-left">
            <div class="brand">
                <div class="brand-icon">üõ∞Ô∏è</div>
                <div class="brand-meta">
                    <div class="brand-name">Ahmad IDE</div>
                    <div class="brand-sub">PhpStorm Brown</div>
                </div>
            </div>
            <nav class="menu-cluster">
                <div class="menu-item" data-menu="file">
                    File
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="new-project">New Project...</button>
                        <button class="menu-action" data-action="open-project">Open Project...</button>
                        <button class="menu-action" data-action="new-file">New File</button>
                        <button class="menu-action" data-action="save" id="menuSaveBtn">Save</button>
                        <button class="menu-action" data-action="save-all">Save All</button>
                        <button class="menu-action" data-action="close-project">Close Project</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="edit">
                    Edit
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="undo">Undo</button>
                        <button class="menu-action" data-action="redo">Redo</button>
                        <button class="menu-action" data-action="cut">Cut</button>
                        <button class="menu-action" data-action="copy">Copy</button>
                        <button class="menu-action" data-action="paste">Paste</button>
                        <button class="menu-action" data-action="comment">Toggle Comment</button>
                        <button class="menu-action" data-action="duplicate-line">Duplicate Line (Ctrl+D)</button>
                        <button class="menu-action" data-action="find">Find</button>
                        <button class="menu-action" data-action="replace">Replace</button>
                        <button class="menu-action" data-action="shortcuts">Shortcuts‚Ä¶</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="view">
                    View
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="toggle-sidebar">Toggle Sidebar</button>
                        <button class="menu-action" data-action="toggle-terminal">Toggle Terminal</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="navigate">
                    Navigate
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="goto-line">Go to Line</button>
                        <button class="menu-action" data-action="goto-file" disabled>Go to File</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="code">
                    Code
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="reformat" disabled>Reformat Code</button>
                        <button class="menu-action" data-action="comment">Toggle Comment</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="git">
                    Git
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="git">Open Git</button>
                        <button class="menu-action" data-action="git-status">Status</button>
                        <button class="menu-action" data-action="git-diff">Diff</button>
                        <button class="menu-action" data-action="git-history">History</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="run">
                    Run
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="run">Run</button>
                        <button class="menu-action" data-action="debug">Debug</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="connections">
                    Connections
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="connections">Open Connections</button>
                        <button class="menu-action" data-action="docker" id="menuDockerBtn">Docker</button>
                        <button class="menu-action" data-action="ssh" id="menuSshBtn">SSH</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="tools">
                    Tools
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="terminal">Terminal</button>
                        <button class="menu-action" data-action="lint">Run Lint</button>
                        <button class="menu-action" data-action="git">Git Panel</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="settings">
                    Settings
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="settings">Preferences</button>
                    </div>
                </div>
                <div class="menu-item" data-menu="help">
                    Help
                    <div class="menu-dropdown">
                        <button class="menu-action" data-action="docs">Docs</button>
                        <button class="menu-action" data-action="about">About</button>
                    </div>
                </div>
            </nav>
        </div>
        <div class="menu-right">
            <div class="theme-switcher">
                <label for="ideThemeSelect">IDE</label>
                <select id="ideThemeSelect">
                    <option value="earth">Earth Dark</option>
                    <option value="desert">Desert Contrast</option>
                </select>
            </div>
            <div class="theme-switcher">
                <label for="codeThemeSelect">Code</label>
                <select id="codeThemeSelect">
                    <option value="mumps-earth">Earthy</option>
                    <option value="mumps-dark">Carbon</option>
                </select>
            </div>
            <button class="btn ghost" id="toggleConnections">Connections</button>
            <div class="pill" id="connStatus">Ready</div>
        </div>
    </header>

    <div class="body">
        <div class="content-area">
            <aside class="sidebar">
                <div class="panel-title">PROJECT</div>
                <input class="filter-input" id="routineFilterInput" placeholder="Filter..." style="display:none;">
                <div class="project-tree" id="projectTree"></div>
            </aside>

            <main class="main">
            <div class="tabbar">
                <div id="tabBar" class="tab-container"></div>
            </div>
            <div class="action-bar">
                <div class="crumbs" id="breadcrumbs">
                    <span class="breadcrumb-item">Project</span>
                </div>
                <div class="actions">
                    <button class="btn ghost icon-btn toolbar-btn" id="saveRoutineBtn" title="Save (Ctrl+S)">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M13.5 1h-11C1.7 1 1 1.7 1 2.5v11c0 .8.7 1.5 1.5 1.5h11c.8 0 1.5-.7 1.5-1.5v-11c0-.8-.7-1.5-1.5-1.5zM11 2v4H5V2h6zm2 11.5c0 .3-.2.5-.5.5h-9c-.3 0-.5-.2-.5-.5v-9c0-.3.2-.5.5-.5H4v5h8V4h.5c.3 0 .5.2.5.5v9z"/><circle cx="8" cy="10" r="1.5"/></svg>
                    </button>
                    <button class="btn ghost icon-btn toolbar-btn" id="undoBtn" title="Undo (Ctrl+Z)">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 2c-2.2 0-4.2.9-5.7 2.3L1 3v5h5L4.3 6.3C5.4 5.2 6.6 4.5 8 4.5c2.5 0 4.5 2 4.5 4.5s-2 4.5-4.5 4.5c-1.7 0-3.2-.9-4-2.3l-1.7 1C3.4 14.4 5.6 15.5 8 15.5c3.6 0 6.5-2.9 6.5-6.5S11.6 2 8 2z"/></svg>
                    </button>
                    <button class="btn ghost icon-btn toolbar-btn" id="redoBtn" title="Redo (Ctrl+Shift+Z)">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 2c2.2 0 4.2.9 5.7 2.3L15 3v5h-5l1.7-1.7C10.6 5.2 9.4 4.5 8 4.5c-2.5 0-4.5 2-4.5 4.5s2 4.5 4.5 4.5c1.7 0 3.2-.9 4-2.3l1.7 1C12.6 14.4 10.4 15.5 8 15.5c-3.6 0-6.5-2.9-6.5-6.5S4.4 2 8 2z"/></svg>
                    </button>
                    <div class="toolbar-separator"></div>
                    <button class="btn ghost icon-btn toolbar-btn" id="lintBtn" title="Lint Code">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 1l-1.5 1.5L8 4 9.5 2.5 8 1zM3.5 3.5L2 5l1.5 1.5L5 5 3.5 3.5zm9 0L11 5l1.5 1.5L14 5l-1.5-1.5zM8 5c-1.7 0-3 1.3-3 3v5h6V8c0-1.7-1.3-3-3-3zm0 2c.6 0 1 .4 1 1v3H7V8c0-.6.4-1 1-1z"/></svg>
                    </button>
                    <button class="btn ghost icon-btn toolbar-btn" id="debugStartBtn" title="Debug (Shift+F9)">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 2C6.3 2 5 3.3 5 5v1H3v2h2v1c0 .7.2 1.3.6 1.9L4 12.5l1.4 1.4L7 12.3c.6.4 1.3.7 2 .7s1.4-.2 2-.7l1.6 1.6 1.4-1.4-1.6-1.6c.4-.5.6-1.2.6-1.9V8h2V6h-2V5c0-1.7-1.3-3-3-3zm0 2c.6 0 1 .4 1 1v5c0 .6-.4 1-1 1s-1-.4-1-1V5c0-.6.4-1 1-1z"/></svg>
                    </button>
                    <button class="btn primary icon-btn toolbar-btn" id="runBtn" title="Run (Ctrl+Enter)">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M4 2v12l10-6L4 2z"/></svg>
                    </button>
                </div>
            </div>
            <div class="editor-frame">
                <div id="editor"></div>
            </div>
            </main>
        </div>

        <!-- PhpStorm-style bottom panel (full width) -->
        <div class="bottom-panel">
            <div class="bottom-stack">
                <div class="toolwindows-rail">
                    <button class="toolwindow-btn active" data-panel="terminalPanel" title="Terminal">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M2 3v10h12V3H2zm10 8H4V5h8v6z"/>
                            <path d="M5 7l2 1.5L5 10" stroke="currentColor" fill="none" stroke-width="1.2"/>
                            <path d="M8 9h2" stroke="currentColor" stroke-width="1.2"/>
                        </svg>
                    </button>
                    <button class="toolwindow-btn" data-panel="debugPanel" title="Debug">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <circle cx="8" cy="8" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M8 2v2M8 12v2M2 8h2M12 8h2" stroke="currentColor" stroke-width="1.2"/>
                        </svg>
                    </button>
                    <button class="toolwindow-btn" data-panel="gitToolPanel" title="Git">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <circle cx="4" cy="4" r="2"/>
                            <circle cx="12" cy="12" r="2"/>
                            <path d="M5.5 5.5l5 5" stroke="currentColor" stroke-width="1.8" fill="none"/>
                        </svg>
                    </button>
                    <button class="toolwindow-btn" data-panel="problemsPanel" title="Problems">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 2l6 12H2L8 2z"/>
                            <path d="M8 6v4" stroke="#2b2b2b" stroke-width="1.2"/>
                            <circle cx="8" cy="12" r="0.8" fill="#2b2b2b"/>
                        </svg>
                    </button>
                    <button class="toolwindow-btn" data-panel="servicesPanel" title="Services (Docker / SSH)">
                        <div class="toolwindow-icon-multi">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <rect x="2" y="5" width="12" height="7" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                <path d="M6 3h4v2H6z"/>
                            </svg>
                            <span class="service-chip service-chip-docker" aria-hidden="true">D</span>
                        </div>
                    </button>
                </div>
                <div class="toolwindows-content">
                <section class="panel terminal" id="terminalPanel">
                    <div class="pane-header">
                        <div class="pane-title">Terminal</div>
                        <div class="pane-actions">
                            <div class="pill subtle">Output</div>
                            <div id="terminalTabs" class="terminal-tabs"></div>
                            <button class="btn ghost" id="newTerminalBtn">+ Terminal</button>
                            <button class="btn ghost" id="clearOutputBtn">Clear</button>
                        </div>
                    </div>
                    <div class="output" id="output">Ready.</div>
                    <div class="terminal-input-row">
                        <span class="prompt">$</span>
                        <input id="terminalInput" class="terminal-input" placeholder="Enter command and press Enter">
                    </div>
                </section>
                <section class="panel debug-panel" id="debugPanel">
                    <div class="pane-header">
                    <div class="pane-title">Debug</div>
                    <div class="pill subtle">Breakpoints / Locals / Stack / Output</div>
                    <div class="pane-subtitle">Tip: while paused, hover variables in the editor to see their values.</div>
                </div>
                <div class="debug-tabs">
                        <div class="debug-tab active" data-tab="tab-breakpoints">Breakpoints</div>
                        <div class="debug-tab" data-tab="tab-variables">Variables</div>
                        <div class="debug-tab" data-tab="tab-watches">Watches</div>
                        <div class="debug-tab" data-tab="tab-stack">Call Stack</div>
                        <div class="debug-tab" data-tab="tab-console">Console</div>
                        <div class="debug-tab" data-tab="tab-problems">Problems</div>
                    </div>
                    <div class="debug-tabpanes">
                        <div class="debug-tabpane active" id="tab-breakpoints">
                            <div class="bp-action-row">
                                <button class="btn ghost" id="bpClearAllBtn">Clear All</button>
                            </div>
                            <ul class="problems-list" id="breakpointsList"></ul>
                        </div>
                        <div class="debug-tabpane" id="tab-variables">
                            <ul class="problems-list" id="localsList"></ul>
                        </div>
                        <div class="debug-tabpane" id="tab-watches">
                            <div class="pane-subtitle">Watches not implemented.</div>
                        </div>
                        <div class="debug-tabpane" id="tab-stack">
                            <ul class="problems-list" id="stackList"></ul>
                        </div>
                        <div class="debug-tabpane" id="tab-console">
                            <pre class="debug-output" id="debugOutput"></pre>
                        </div>
                        <div class="debug-tabpane" id="tab-problems">
                            <ul class="problems-list" id="problemsList"></ul>
                        </div>
                    </div>
                </section>
                <section class="panel debug-panel hidden" id="problemsPanel">
                    <div class="pane-header">
                        <div class="pane-title">Problems</div>
                        <div class="pill subtle">Diagnostics</div>
                    </div>
                    <ul class="problems-list" id="problemsListStandalone"></ul>
                </section>
                <section class="panel debug-panel hidden" id="gitToolPanel">
                    <div class="pane-header">
                        <div class="pane-title">Git</div>
                        <div class="pill subtle">Status / Log / Diff</div>
                    </div>
                    <div class="git-grid">
                        <div class="git-left">
                            <div class="pane-title">Changes</div>
                            <div class="pane-subtitle">Modified/Added/Deleted</div>
                            <div class="git-changes-list" id="gitChangesList">Run status to load changes.</div>
                            <div class="pane-title" style="margin-top:10px;">Commit</div>
                            <textarea id="gitCommitMessage" class="git-commit-input" placeholder="Commit message"></textarea>
                            <div class="flex git-actions">
                                <button class="btn primary" id="gitCommitBtn">Commit</button>
                                <button class="btn ghost" id="gitPushBtn">Push</button>
                                <button class="btn ghost" id="gitPullBtn">Pull</button>
                                <button class="btn ghost" id="gitFetchBtn">Fetch</button>
                            </div>
                            <div class="pane-title" style="margin-top:6px;">Branch</div>
                            <div class="git-branch-row">
                                <select id="gitBranchSelect" class="git-branch-select"></select>
                                <input id="gitBranchInput" class="git-branch-input" placeholder="New branch name">
                                <button class="btn ghost" id="gitCheckoutBtn">Checkout</button>
                            </div>
                        </div>
                        <div class="git-right">
                            <div class="pane-title">History</div>
                            <div class="flex" style="margin-bottom:6px;">
                                <button class="btn ghost" id="gitStatusBtn">Status</button>
                                <button class="btn ghost" id="gitLogBtn">Log</button>
                                <button class="btn ghost" id="gitDiffBtn">Diff (stat)</button>
                                <button class="btn ghost" id="gitClearBtn">Clear</button>
                            </div>
                            <pre class="debug-output" id="gitOutput">Git ready.</pre>
                            <div class="pane-title" style="margin-top:8px;">File Diff</div>
                            <div class="flex" style="gap:6px; margin-bottom:6px;">
                                <input class="ssh-input" id="gitDiffPath" placeholder="Path (relative)">
                                <button class="btn ghost" id="gitDiffFileBtn">Show Diff</button>
                                <button class="btn ghost" id="gitHistoryFileBtn">File History</button>
                            </div>
                            <div class="pane-title" style="margin-top:6px;">Compare Two Files</div>
                            <div class="flex" style="gap:6px; margin-bottom:6px;">
                                <input class="ssh-input" id="gitComparePathA" placeholder="Path A">
                                <input class="ssh-input" id="gitComparePathB" placeholder="Path B">
                                <button class="btn ghost" id="gitCompareBtn">Compare</button>
                            </div>
                            <div class="git-diff-grid">
                                <pre class="debug-output" id="gitDiffLeft">Left</pre>
                                <pre class="debug-output" id="gitDiffRight">Right</pre>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="panel debug-panel hidden" id="servicesPanel">
                    <div class="pane-header">
                        <div class="pane-title">Services</div>
                        <div class="pill subtle">Docker / SSH</div>
                    </div>
                    <div class="pane-title">Docker</div>
                    <div class="pane-subtitle">List running containers</div>
                    <div class="flex" style="margin-bottom:6px;">
                        <button class="btn ghost" id="svcDockerListBtn">List Containers</button>
                        <button class="btn ghost" id="svcDockerRefreshBtn">Refresh</button>
                    </div>
                    <div class="git-changes-list" id="svcDockerOutput">Docker services not queried.</div>
                    <div class="pane-title" style="margin-top:10px;">SSH</div>
                    <div class="pane-subtitle">Run simple command</div>
                    <div class="flex" style="gap:6px; margin-bottom:6px;">
                        <input class="ssh-input" id="svcSshCmd" placeholder="Command (requires SSH config)">
                        <button class="btn ghost" id="svcSshRunBtn">Run</button>
                    </div>
                    <div class="git-changes-list" id="svcSshOutput">SSH services not queried.</div>
                </section>
                </div>
            </div>
        </div>
    </div>

    <footer class="statusbar">
        <div class="status-left">
            <span class="status-item" id="gitBranch" title="Git Branch">
                <span class="icon">‚éá</span> main
            </span>
            <span class="status-item" id="problemsSummary" title="Problems">
                <span class="icon">‚ö†</span> 0
            </span>
        </div>
        <div class="status-right">
            <span class="status-item" id="lineColInfo" title="Line:Column">Ln 1, Col 1</span>
            <span class="status-item" id="currentRoutineLabel" title="Current File">main.m</span>
            <span class="status-item" id="fileLanguage" title="Language">MUMPS</span>
            <span class="status-item" id="fileEncoding" title="Encoding">UTF-8</span>
            <span class="status-item" id="lineEndings" title="Line Endings">LF</span>
            <span class="status-item" id="envInfo">Loading...</span>
        </div>
    </footer>
</div>

<!-- Connections panel -->
<div id="connectionsOverlay" class="connections-overlay hidden"></div>
<div id="connectionsPanel" class="connections-panel hidden">
    <div class="connections-header">
        <div>
            <div class="pane-title">Connections</div>
            <div class="pane-subtitle">Switch between Docker and SSH</div>
        </div>
        <button class="btn ghost icon-btn" id="closeConnectionsBtn" title="Close">‚úï</button>
    </div>
    <div class="connections-grid">
        <div class="connection-card">
            <div class="panel-title">Docker</div>
            <div class="pane-subtitle">Pick a running container</div>
            <div id="dockerList" class="list docker-list"></div>
            <div class="flex">
                <button class="btn ghost" id="refreshDockerBtn">Refresh Docker</button>
                <button class="btn ghost" id="useLocalDockerBtn">Use Default</button>
            </div>
        </div>
        <div class="connection-card">
            <div class="panel-title">SSH</div>
            <div class="pane-subtitle">Connect to a remote host</div>
            <div class="ssh-form">
                <input class="ssh-input" id="sshHostInput" placeholder="Host (e.g., 10.0.0.5)">
                <input class="ssh-input" id="sshPortInput" placeholder="Port (default 22)" type="number" min="1" max="65535">
                <input class="ssh-input" id="sshEnvInput" placeholder="Environment key (e.g., cc)">
                <input class="ssh-input" id="sshUserInput" placeholder="Username">
                <input class="ssh-input" id="sshPassInput" placeholder="Password" type="password">
                <button class="btn primary" id="sshConnectBtn">Connect SSH</button>
            </div>
            <div class="pill subtle" id="sshFormStatus">Not connected</div>
            <div class="ssh-saved">
                <div class="pane-subtitle">Saved environments</div>
                <div id="sshSavedList" class="saved-env-list"></div>
                <div class="flex">
                    <button class="btn ghost" id="sshSaveEnvBtn">Save environment</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Shortcuts panel -->
<div id="shortcutsOverlay" class="connections-overlay hidden"></div>
<div id="shortcutsPanel" class="connections-panel hidden">
    <div class="connections-header">
        <div>
            <div class="pane-title">Keyboard Shortcuts</div>
            <div class="pane-subtitle">Current bindings (owner configurable)</div>
        </div>
        <button class="btn ghost icon-btn" id="closeShortcutsBtn" title="Close">‚úï</button>
    </div>
    <div class="connections-grid">
        <div class="connection-card">
            <div class="panel-title">Registered Commands</div>
            <div class="pane-subtitle">Click to copy summary</div>
            <ul class="problems-list" id="shortcutsList"></ul>
            <div class="pane-title" style="margin-top:8px;">Update Binding</div>
            <div class="ssh-form">
                <select class="ssh-input" id="shortcutSelect">
                    <option value="duplicate-line">Duplicate Line</option>
                    <option value="run-code">Run</option>
                    <option value="lint-code">Lint</option>
                    <option value="toggle-sidebar">Toggle Sidebar</option>
                    <option value="toggle-terminal">Toggle Terminal</option>
                    <option value="new-terminal">New Terminal</option>
                </select>
                <input class="ssh-input" id="shortcutInput" placeholder="e.g., Ctrl+D">
                <button class="btn primary" id="saveShortcutBtn">Save Binding</button>
            </div>
            <div class="pane-subtitle">Valid: Ctrl/Cmd/Shift/Alt + Letter/Enter/F-keys (e.g., Ctrl+Shift+L)</div>
        </div>
    </div>
</div>

<!-- Project Search modal -->
<div id="projectSearchOverlay" class="overlay hidden"></div>
<div id="projectSearchModal" class="search-modal hidden">
    <div class="search-header">
        <div>
            <div class="pane-title" id="searchModalTitle">Find in Project</div>
            <div class="pane-subtitle">Ctrl+Shift+F (Find) ¬∑ Ctrl+Shift+R (Replace) ¬∑ Double Shift (Search Everywhere)</div>
        </div>
        <button class="btn ghost icon-btn" id="closeProjectSearchBtn" title="Close">‚úï</button>
    </div>
    <div class="search-body">
        <div class="search-inputs">
            <div class="search-row">
                <input class="search-input" id="projectSearchQuery" placeholder="Search term (case-insensitive)">
                <button class="btn ghost icon-btn search-icon-btn" id="projectSearchRunBtn" title="Run search">üîç</button>
                <button class="btn ghost icon-btn search-icon-btn" id="projectSearchCaseBtn" title="Match Case">Aa</button>
            </div>
            <input class="search-input" id="projectReplaceInput" placeholder="Replace with" style="display:none;">
        </div>
        <div class="search-actions">
            <button class="btn ghost" id="projectReplaceRunBtn" style="display:none;">Replace All</button>
        </div>
        <div class="search-results" id="projectSearchResults">Type a term to search routines‚Ä¶</div>
    </div>
</div>

<!-- Git panel -->
<div id="gitOverlay" class="connections-overlay hidden"></div>
<div id="gitPanel" class="connections-panel hidden">
    <div class="connections-header">
        <div>
            <div class="pane-title">Git</div>
            <div class="pane-subtitle">Status / Log / Diff (workspace)</div>
        </div>
        <button class="btn ghost icon-btn" id="closeGitBtn" title="Close">‚úï</button>
    </div>
    <div class="git-grid">
        <div class="git-left">
            <div class="pane-title">Changes</div>
            <div class="pane-subtitle">Modified/Added/Deleted</div>
            <div class="git-changes-list" id="gitChangesList">Run status to load changes.</div>
            <div class="pane-title" style="margin-top:10px;">Commit</div>
            <textarea id="gitCommitMessage" class="git-commit-input" placeholder="Commit message"></textarea>
            <div class="flex git-actions">
                <button class="btn primary" id="gitCommitBtn">Commit</button>
                <button class="btn ghost" id="gitPushBtn">Push</button>
                <button class="btn ghost" id="gitPullBtn">Pull</button>
                <button class="btn ghost" id="gitFetchBtn">Fetch</button>
            </div>
            <div class="pane-title" style="margin-top:6px;">Branch</div>
            <div class="git-branch-row">
                <select id="gitBranchSelect" class="git-branch-select"></select>
                <input id="gitBranchInput" class="git-branch-input" placeholder="New branch name">
                <button class="btn ghost" id="gitCheckoutBtn">Checkout</button>
            </div>
        </div>
        <div class="git-right">
            <div class="pane-title">History</div>
            <div class="flex" style="margin-bottom:6px;">
                <button class="btn ghost" id="gitStatusBtn">Status</button>
                <button class="btn ghost" id="gitLogBtn">Log</button>
                <button class="btn ghost" id="gitDiffBtn">Diff (stat)</button>
                <button class="btn ghost" id="gitClearBtn">Clear</button>
            </div>
            <pre class="debug-output" id="gitOutput">Git ready.</pre>
            <div class="pane-title" style="margin-top:8px;">File Diff</div>
            <div class="flex" style="gap:6px; margin-bottom:6px;">
                <input class="ssh-input" id="gitDiffPath" placeholder="Path (relative)">
                <button class="btn ghost" id="gitDiffFileBtn">Show Diff</button>
                <button class="btn ghost" id="gitHistoryFileBtn">File History</button>
            </div>
            <div class="pane-title" style="margin-top:6px;">Compare Two Files</div>
            <div class="flex" style="gap:6px; margin-bottom:6px;">
                <input class="ssh-input" id="gitComparePathA" placeholder="Path A">
                <input class="ssh-input" id="gitComparePathB" placeholder="Path B">
                <button class="btn ghost" id="gitCompareBtn">Compare</button>
            </div>
            <div class="git-diff-grid">
                <pre class="debug-output" id="gitDiffLeft">Left</pre>
                <pre class="debug-output" id="gitDiffRight">Right</pre>
            </div>
        </div>
    </div>
</div>

<!-- Editor context menu -->
<div id="editorContextMenu" class="context-menu">
    <div class="ctx-item" data-action="ctx-cut">Cut</div>
    <div class="ctx-item" data-action="ctx-copy">Copy</div>
    <div class="ctx-item" data-action="ctx-paste">Paste</div>
    <div class="ctx-separator"></div>
    <div class="ctx-item" data-action="ctx-comment">Toggle Comment</div>
    <div class="ctx-item" data-action="ctx-run">Run</div>
    <div class="ctx-item" data-action="ctx-debug">Debug</div>
    <div class="ctx-separator"></div>
    <div class="ctx-item git-parent" data-action="ctx-git-parent">Git ‚ñ∏
        <div class="context-menu git-submenu">
            <div class="ctx-item" data-action="ctx-git-status">Status</div>
            <div class="ctx-item" data-action="ctx-git-diff">Diff</div>
            <div class="ctx-item" data-action="ctx-git-history">History</div>
            <div class="ctx-item" data-action="ctx-git-push">Push</div>
            <div class="ctx-item" data-action="ctx-git-pull">Pull</div>
        </div>
    </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<!-- Settings panel -->
<div id="settingsOverlay" class="connections-overlay hidden"></div>
<div id="settingsPanel" class="connections-panel hidden">
    <div class="connections-header">
        <div>
            <div class="pane-title">Settings</div>
            <div class="pane-subtitle">Preferences</div>
        </div>
        <button class="btn ghost icon-btn" id="closeSettingsBtn" title="Close">‚úï</button>
    </div>
    <div class="connections-grid">
        <div class="connection-card">
            <div class="pane-title">Appearance</div>
            <div class="pane-subtitle">IDE & Code themes</div>
            <div class="ssh-form">
                <label class="pane-subtitle">IDE Theme</label>
                <select class="ssh-input" id="settingsIdeTheme">
                    <option value="earth">Earth Dark</option>
                    <option value="desert">Desert Contrast</option>
                </select>
                <label class="pane-subtitle">Code Theme</label>
                <select class="ssh-input" id="settingsCodeTheme">
                    <option value="mumps-earth">Earthy</option>
                    <option value="mumps-dark">Carbon</option>
                </select>
            </div>
        </div>
        <div class="connection-card">
            <div class="pane-title">Git</div>
            <div class="pane-subtitle">Configure author & remote</div>
            <div class="ssh-form">
                <input class="ssh-input" id="gitUserName" placeholder="User name (git config user.name)">
                <input class="ssh-input" id="gitUserEmail" placeholder="Email (git config user.email)">
                <input class="ssh-input" id="gitRemoteUrl" placeholder="Remote URL (origin)">
                <button class="btn primary" id="gitSettingsSave">Save Git Settings</button>
                <button class="btn ghost" id="gitSettingsTest">Test Git Status</button>
            </div>
            <div class="pane-subtitle" id="gitSettingsStatus">Not applied</div>
        </div>
        <div class="connection-card">
            <div class="pane-title">Developer Tools</div>
            <div class="pane-subtitle">Debug and inspect IDE</div>
            <button class="btn primary" id="toggleDevTools">Toggle DevTools</button>
        </div>
        <div class="connection-card">
            <div class="pane-title">Terminal</div>
            <div class="pane-subtitle">Shell settings (stub)</div>
        </div>
        <div class="connection-card">
            <div class="pane-title">SSH / Docker</div>
            <div class="pane-subtitle">Configure remotes (stub)</div>
        </div>
    </div>
</div>

<!-- New Project panel -->
<div id="newProjectOverlay" class="connections-overlay hidden"></div>
<div id="newProjectPanel" class="connections-panel hidden">
    <div class="connections-header">
        <div>
            <div class="pane-title">New Project</div>
            <div class="pane-subtitle">Create web + routines structure</div>
        </div>
        <button class="btn ghost icon-btn" id="closeNewProjectBtn" title="Close">‚úï</button>
    </div>
    <div class="connections-grid">
        <div class="connection-card">
            <div class="panel-title">Project Details</div>
            <div class="pane-subtitle">Name and location</div>
            <div class="ssh-form">
                <label class="pane-subtitle">Project Name</label>
                <input class="ssh-input" id="projectName" placeholder="my-project">

                <label class="pane-subtitle">Project Path (parent directory)</label>
                <input class="ssh-input" id="projectPath" placeholder="/home/ahmad/projects" value="/home/ahmad/projects">

                <div class="pane-subtitle" style="margin-top:12px;">
                    <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                        <input type="checkbox" id="fetchRoutines" checked style="cursor:pointer;">
                        Auto-fetch MUMPS routines from Docker (max 100)
                    </label>
                </div>

                <button class="btn primary" id="createProjectBtn" style="margin-top:16px;">Create Project</button>
            </div>
            <div class="pill subtle" id="projectCreationStatus">Ready</div>
        </div>

        <div class="connection-card">
            <div class="panel-title">Structure Preview</div>
            <div class="pane-subtitle">Will be created:</div>
            <pre class="debug-output" id="structurePreview" style="font-size:12px; line-height:1.6;">my-project/
‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îî‚îÄ‚îÄ (empty - add your PHP files here)
‚îî‚îÄ‚îÄ routines/
    ‚îî‚îÄ‚îÄ (MUMPS .m files from Docker)</pre>
        </div>
    </div>
</div>

<!-- Floating debug bar -->
<div id="debugBar" class="debug-float hidden">
    <button data-cmd="continue" id="dbgContinueBtn">‚ñ∂</button>
    <button data-cmd="pause" id="dbgPauseBtn">‚è∏</button>
    <button data-cmd="step-over" id="dbgStepOverBtn">‚Ü∑</button>
    <button data-cmd="step-into" id="dbgStepIntoBtn">‚Üò</button>
    <button data-cmd="step-out" id="dbgStepOutBtn">‚Üó</button>
    <button data-cmd="restart" id="dbgRestartBtn">‚ü≤</button>
    <button data-cmd="stop" id="dbgStopBtn">‚ñ†</button>
</div>

<script src="./libs/jquery.min.js"></script>
<script src="./assets/mumps/mumps-validator.js"></script>
<script src="./assets/mumps/mumps-linter.js"></script>
<script src="./assets/mumps/mumps-lexer.js"></script>
<script src="./assets/mumps/mumps-ast.js"></script>
<script src="./assets/mumps/mumps-parser.js"></script>
<script src="./renderer.js"></script>
</body>
</html>
