:root {
    --bottom-toolwindow-height: 320px;
    /* PhpStorm Darcula (Dark) palette */
    --bg: #2b2b2b;
    --glass: rgba(60, 63, 65, 0.9);
    --panel: #3c3f41;
    --panel-2: #313335;
    --panel-strong: #3c3f41;
    --panel-soft: #2d2f30;
    --sidebar: #3c3f41;
    --rail-bg: #313335;
    --editor-bg: #2b2b2b;
    --gutter-bg: #313335;
    --terminal-bg: #2b2b2b;
    --terminal-input-bg: #313335;

    /* Accents */
    --accent: #4a9eff;
    --accent-2: #6db0ff;
    --accent-blue: #4a9eff;
    --accent-green: #6a8759;
    --accent-orange: #cc7832;
    --accent-soft: rgba(74, 158, 255, 0.15);
    --accent-soft-border: rgba(74, 158, 255, 0.35);

    /* Text */
    --text: #bbbbbb;
    --text-bright: #ffffff;
    --muted: #808080;
    --border: #323232;

    /* Selection / hover */
    --tree-selected: #214283;
    --tree-selected-text: #ffffff;
    --selection-bg: #214283;
    --hover-bg: #2d2f30;

    /* Soft glows */
    --glow-1: rgba(53, 116, 240, 0.08);
    --glow-2: rgba(91, 141, 239, 0.06);

    /* Typography */
    --font-ui: 'Inter', 'Segoe UI', 'SF Pro Display', system-ui, sans-serif;
    --font-code: 'Fira Code', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    --font-size-ui: 13px;
    --font-size-code: 13px;
    --font-terminal: var(--font-code);
    --font-size-terminal: var(--font-size-code);
    --line-height-code: 1.55;
    --font-weight-code: 400;
    --font-ligatures-code: 1;

    /* UI Typography tokens */
    --ui-font-ui: var(--font-ui);
    --ui-font-code: var(--font-code);
    --ui-font-ui-size: var(--font-size-ui);
    --ui-font-code-size: var(--font-size-code);

    /* Spacing */
    --ui-space-0: 0px;
    --ui-space-1: 4px;
    --ui-space-2: 8px;
    --ui-space-3: 12px;
    --ui-space-4: 16px;
    --ui-space-5: 20px;
    --ui-space-6: 24px;
    --ui-space-7: 32px;

    /* Radius */
    --ui-radius-1: 6px;
    --ui-radius-2: 8px;
    --ui-radius-3: 10px;

    /* Borders */
    --ui-border-width: 1px;
    --ui-border-subtle: rgba(255, 255, 255, 0.08);
    --ui-border-strong: rgba(255, 255, 255, 0.14);

    /* Surfaces */
    --ui-surface-bg: var(--bg);
    --ui-surface-panel: var(--panel);
    --ui-surface-panel2: var(--panel-2);
    --ui-surface-overlay: rgba(0, 0, 0, 0.55);
    --ui-surface-elevated: rgba(60, 63, 65, 0.96);

    /* Text */
    --ui-text-primary: var(--text);
    --ui-text-bright: var(--text-bright);
    --ui-text-muted: var(--muted);

    /* Focus */
    --ui-focus-ring: 0 0 0 2px rgba(74, 158, 255, 0.35);
    --ui-focus-outline: rgba(74, 158, 255, 0.55);

    /* Shadows */
    --ui-shadow-xs: 0 1px 3px rgba(0, 0, 0, 0.18);
    --ui-shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.25);
    --ui-shadow-md: 0 8px 18px rgba(0, 0, 0, 0.55);
    --ui-shadow-lg: 0 18px 40px rgba(0, 0, 0, 0.5);

    /* Z-index */
    --ui-z-base: 1;
    --ui-z-rail: 10;
    --ui-z-toolbar: 90;
    --ui-z-menubar: 100;
    --ui-z-popover: 200;
    --ui-z-menu: 7000;
    --ui-z-overlay: 6000;
    --ui-z-dialog: 10000;
    --ui-z-toast: 10010;
    --ui-z-splash: 99999;

    /* Icon sizes */
    --ui-icon-12: 12px;
    --ui-icon-16: 16px;
    --ui-icon-20: 20px;

    /* ============================================
       Parity Spec Sheet Metrics (Phase 3A-0)
       ============================================ */
    --ui-menubar-row-h: 40px;
    --ui-toolbar-row-h: 48px;
    --ui-statusbar-h: 24px;

    /* Menus / Context menus */
    --ui-menubar-h: 32px;

    --ui-menu-min-w: 240px;
    --ui-menu-row-h: 26px;
    --ui-menu-pad-x: 12px;
    --ui-menu-icon-col-w: 16px;
    --ui-menu-shortcut-col-w: 96px;
    --ui-menu-arrow-col-w: 12px;

    /* Submenu intention (ms, px) */
    --ui-submenu-open-delay: 120;
    --ui-submenu-close-delay: 320;
    --ui-submenu-grace-px: 16;

    /* Tool windows */
    --ui-stripe-w: 36px;
    --ui-stripe-bottom-h: 28px;
    --ui-sidebar-left-w: 280px;
    --ui-sidebar-right-w: 300px;
    --ui-toolwindow-header-h: 32px;

    /* Dialogs (modal) */
    --ui-dialog-max-w: 980px;
    --ui-dialog-max-h: 720px;
    --ui-dialog-inset: 56px;
    --ui-dialog-header-h: 44px;
    --ui-dialog-sidebar-w: 260px;

    /* Motion */
    --ui-motion-fast: 120ms;
    --ui-motion-normal: 180ms;
    --ui-motion-slow: 220ms;
    --ui-ease: cubic-bezier(0.2, 0.0, 0.0, 1.0);

    /* ============================================
       Menu System Metrics (Phase 3A)
       All menus/context menus use these tokens.
       ============================================ */
    /* Menu surfaces */
    --ui-menu-bg: #26282b;
    --ui-menu-border: rgba(255, 255, 255, 0.08);
    --ui-menu-hover: rgba(255, 255, 255, 0.04);
    --ui-menu-active: rgba(74, 158, 255, 0.14);
    --ui-menu-active-border: rgba(74, 158, 255, 0.26);
}

/* ============================================
   PERFORMANCE: Disable ALL transitions/animations
   Remove these rules to restore animations
   ============================================ */
*,
*::before,
*::after {
    transition: none !important;
    animation: none !important;
    animation-duration: 0s !important;
    transition-duration: 0s !important;
}

/* Keep cursor blinking for editor */
.monaco-editor .cursor {
    animation: monaco-cursor-blink 1s step-end infinite !important;
}

@keyframes monaco-cursor-blink {
    50% {
        opacity: 0;
    }
}

/* ============================================ */

* {
    box-sizing: border-box;
}

html,
body {
    height: 100%;
    margin: 0;
    padding: 0;
}

body {
    margin: 0;
    padding: 0;
    font-family: var(--ui-font-ui);
    font-size: var(--ui-font-ui-size);
    background: #2b2b2b;
    color: var(--text);
    overflow: hidden;
}

button,
input,
select,
textarea {
    font-family: var(--ui-font-ui);
    font-size: var(--ui-font-ui-size);
}

.hidden {
    display: none !important;
}

.ui-icon {
    display: inline-block;
    width: var(--ui-icon-16);
    height: var(--ui-icon-16);
    flex-shrink: 0;
}

.ui-icon--12 {
    width: var(--ui-icon-12);
    height: var(--ui-icon-12);
}

.ui-icon--16 {
    width: var(--ui-icon-16);
    height: var(--ui-icon-16);
}

.ui-icon--20 {
    width: var(--ui-icon-20);
    height: var(--ui-icon-20);
}

.app-shell {
    position: relative;
    display: grid;
    /* PhpStorm layout: menu | toolbar | body+bottom | statusbar */
    grid-template-rows: var(--ui-menubar-row-h) var(--ui-toolbar-row-h) 1fr auto var(--ui-statusbar-h);
    height: 100vh;
    margin: 0;
    padding: 0;
    gap: 0;
    background: #2b2b2b;
}

/* Bottom bar wrapper - spans full width below project and editor */
.bottom-bar-wrapper {
    grid-row: 4;
    display: flex;
    flex-direction: row;
    align-items: stretch;
    /* Ensure children fill height */
    background: #2b2b2b;
    border-top: 1px solid #515151;
    min-height: 0;
    height: auto !important;
    /* Allow shrinking */
    max-height: 80vh;
    z-index: 100;
}

.bottom-bar-wrapper.hidden {
    display: none !important;
}

/* Bottom tool bar - vertical on left */
.bottom-bar-wrapper .tool-window-bar-bottom {
    display: flex;
    flex-direction: column;
    width: var(--ui-stripe-w);
    /* height: auto; removed, let stretch handle it */
    flex-shrink: 0;
    order: -1;
    /* VISUAL: Force to Left side */
    border-top: none;
    border-right: 1px solid #323232;
    padding: 4px 0;
    align-items: center;
    background: #313335;
    z-index: 20;
    /* Ensure icons sit above content if overlap occurs */
}

.bottom-bar-wrapper .tool-window-bar-bottom .tool-window-stripe-btn.horizontal {
    padding: 8px 6px;
}

/* Hide text labels in bottom toolbar - icons only */
.bottom-bar-wrapper .tool-window-bar-bottom .stripe-text {
    display: none !important;
}

/* Bottom content takes remaining space */
.bottom-bar-wrapper .tool-window-content.tool-window-bottom {
    flex: 1;
    height: var(--bottom-toolwindow-height, 320px);
    /* Content dictates height */
    min-height: 200px;
    border-left: none;
    overflow: hidden;
    min-width: 0;
    /* CRITICAL: Allows flex child to shrink properly */
    width: auto;
    position: relative;
    z-index: 10;
}

/* Ambient glow */
.app-shell::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 22% 78%, var(--glow-1), transparent 30%),
        radial-gradient(circle at 86% 62%, var(--glow-2), transparent 26%);
    pointer-events: none;
    filter: blur(60px);
    opacity: 0.8;
}

/* ============================================
   PERFORMANCE MODE (reduce expensive effects)
   Enabled via: <body class="perf-mode"> (also applied to <html> early)
   ============================================ */
:root.perf-mode body *,
:root.perf-mode body *::before,
:root.perf-mode body *::after,
body.perf-mode *,
body.perf-mode *::before,
body.perf-mode *::after {
    backdrop-filter: none !important;
}

:root.perf-mode .app-shell::before,
body.perf-mode .app-shell::before {
    filter: none !important;
    opacity: 0 !important;
}

:root.perf-mode .context-menu,
:root.perf-mode .routines-context-menu,
:root.perf-mode .ctx-submenu,
:root.perf-mode .toast,
:root.perf-mode .connections-panel,
:root.perf-mode .prompt-dialog,
body.perf-mode .context-menu,
body.perf-mode .routines-context-menu,
body.perf-mode .ctx-submenu,
body.perf-mode .toast,
body.perf-mode .connections-panel,
body.perf-mode .prompt-dialog {
    box-shadow: none !important;
}

:root.perf-mode .btn:hover,
body.perf-mode .btn:hover {
    transform: none !important;
    box-shadow: none !important;
}

.menu-bar {
    display: flex;
    align-items: center;
    gap: 16px;
    justify-content: space-between;
    padding: 0 14px;
    height: var(--ui-menubar-row-h);
    border-bottom: 1px solid #323232;
    background: #3c3f41 !important;
    position: relative;
    z-index: var(--ui-z-menubar);
}

.menu-left,
.menu-right {
    display: flex;
    align-items: center;
    gap: 12px;
}

.menu-right {
    min-width: 24px;
}

.menu-cluster {
    display: flex;
    align-items: center;
    gap: 8px;
}

.ui-menubar {
    display: flex;
    align-items: center;
    gap: 2px;
}

.ui-menubar-item {
    height: var(--ui-menubar-h);
    padding: 0 10px;
    border-radius: 6px;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
}

.ui-menubar-item:hover {
    background: var(--hover-bg);
}

.ui-menubar-item:focus-visible {
    outline: 2px solid var(--ui-focus-outline, rgba(74, 158, 255, 0.55));
    outline-offset: 2px;
}

.ui-menubar--focused .ui-menubar-item.focused {
    background: rgba(74, 158, 255, 0.14);
    border-color: rgba(74, 158, 255, 0.22);
    color: var(--text-bright);
}

.menu-item {
    position: relative;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    color: var(--text);
    font-size: 13px;
    font-weight: 500;
}

.menu-item:hover,
.menu-item.open {
    background: var(--hover-bg);
}

.menu-dropdown {
    position: absolute;
    top: 28px;
    left: 0;
    display: grid;
    gap: 2px;
    padding: 4px;
    min-width: 180px;
    background: var(--panel-strong);
    border: 1px solid var(--border);
    border-radius: 6px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
    opacity: 0;
    pointer-events: none;
    transform: translateY(-4px);
    transition: all 0.12s ease;
    z-index: 200;
}

.menu-item.open .menu-dropdown,
.menu-item:hover .menu-dropdown {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}

.menu-separator {
    height: 1px;
    background: var(--border);
    margin: 4px 6px;
}

.menu-action {
    background: transparent;
    border: none;
    border-radius: 4px;
    padding: 6px 10px;
    color: var(--text);
    text-align: left;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
}

.menu-action:hover {
    background: var(--hover-bg);
    border-color: var(--accent-blue);
}

.menu-action:disabled {
    opacity: 0.5;
    cursor: default;
}

.theme-switcher {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #2d2f30 !important;
    border: 1px solid #323232;
    padding: 6px 8px;
    border-radius: 10px;
    font-size: 12px;
    color: #808080 !important;
}

.theme-switcher select {
    background: transparent;
    border: none;
    color: var(--text);
    font-weight: 600;
    outline: none;
}

.theme-switcher label {
    color: var(--muted);
    font-weight: 600;
}
