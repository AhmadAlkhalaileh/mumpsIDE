:root {
    --bottom-toolwindow-height: 320px;
    /* PhpStorm Darcula (Dark) palette */
    --bg: #2b2b2b;
    --glass: rgba(60, 63, 65, 0.9);
    --panel: #3c3f41;
    --panel-2: #313335;
    --panel-strong: #3c3f41;
    --panel-soft: #2d2f30;
    --sidebar: #3c3f41;
    --rail-bg: #313335;
    --editor-bg: #2b2b2b;
    --gutter-bg: #313335;
    --terminal-bg: #2b2b2b;
    --terminal-input-bg: #313335;

    /* Accents */
    --accent: #4a9eff;
    --accent-2: #6db0ff;
    --accent-blue: #4a9eff;
    --accent-green: #6a8759;
    --accent-orange: #cc7832;
    --accent-soft: rgba(74, 158, 255, 0.15);
    --accent-soft-border: rgba(74, 158, 255, 0.35);

    /* Text */
    --text: #bbbbbb;
    --text-bright: #ffffff;
    --muted: #808080;
    --border: #323232;

    /* Selection / hover */
    --tree-selected: #214283;
    --tree-selected-text: #ffffff;
    --selection-bg: #214283;
    --hover-bg: #2d2f30;

    /* Soft glows */
    --glow-1: rgba(53, 116, 240, 0.08);
    --glow-2: rgba(91, 141, 239, 0.06);

    /* Typography */
    --font-ui: 'Inter', 'Segoe UI', 'SF Pro Display', system-ui, sans-serif;
    --font-code: 'JetBrains Mono', 'SFMono-Regular', 'Menlo', 'Consolas', 'Liberation Mono', monospace;
    --font-size-ui: 13px;
    --font-size-code: 13px;
}

/* ============================================
   PERFORMANCE: Disable ALL transitions/animations
   Remove these rules to restore animations
   ============================================ */
*,
*::before,
*::after {
    transition: none !important;
    animation: none !important;
    animation-duration: 0s !important;
    transition-duration: 0s !important;
}

/* Keep cursor blinking for editor */
.monaco-editor .cursor {
    animation: monaco-cursor-blink 1s step-end infinite !important;
}

@keyframes monaco-cursor-blink {
    50% {
        opacity: 0;
    }
}

/* ============================================ */

* {
    box-sizing: border-box;
}

html,
body {
    height: 100%;
    margin: 0;
    padding: 0;
}

body {
    margin: 0;
    padding: 0;
    font-family: var(--font-ui);
    font-size: var(--font-size-ui);
    background: #2b2b2b;
    color: var(--text);
    overflow: hidden;
}

button,
input,
select,
textarea {
    font-family: var(--font-ui);
    font-size: var(--font-size-ui);
}

.hidden {
    display: none !important;
}

.app-shell {
    position: relative;
    display: grid;
    /* PhpStorm layout: menu | toolbar | body+bottom | statusbar */
    grid-template-rows: 40px 48px 1fr auto 24px;
    height: 100vh;
    margin: 0;
    padding: 0;
    gap: 0;
    background: #2b2b2b;
}

/* Bottom bar wrapper - spans full width below project and editor */
.bottom-bar-wrapper {
    grid-row: 4;
    display: flex;
    flex-direction: row;
    align-items: stretch;
    /* Ensure children fill height */
    background: #2b2b2b;
    border-top: 1px solid #515151;
    min-height: 0;
    height: auto !important;
    /* Allow shrinking */
    max-height: 80vh;
    z-index: 100;
}

.bottom-bar-wrapper.hidden {
    display: none !important;
}

/* Bottom tool bar - vertical on left */
.bottom-bar-wrapper .tool-window-bar-bottom {
    display: flex;
    flex-direction: column;
    width: 36px;
    /* height: auto; removed, let stretch handle it */
    flex-shrink: 0;
    order: -1;
    /* VISUAL: Force to Left side */
    border-top: none;
    border-right: 1px solid #323232;
    padding: 4px 0;
    align-items: center;
    background: #313335;
    z-index: 20;
    /* Ensure icons sit above content if overlap occurs */
}

.bottom-bar-wrapper .tool-window-bar-bottom .tool-window-stripe-btn.horizontal {
    padding: 8px 6px;
}

/* Hide text labels in bottom toolbar - icons only */
.bottom-bar-wrapper .tool-window-bar-bottom .stripe-text {
    display: none !important;
}

/* Bottom content takes remaining space */
.bottom-bar-wrapper .tool-window-content.tool-window-bottom {
    flex: 1;
    height: var(--bottom-toolwindow-height, 320px);
    /* Content dictates height */
    min-height: 200px;
    border-left: none;
    overflow: hidden;
    min-width: 0;
    /* CRITICAL: Allows flex child to shrink properly */
    width: auto;
    position: relative;
    z-index: 10;
}

/* Ambient glow */
.app-shell::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 22% 78%, var(--glow-1), transparent 30%),
        radial-gradient(circle at 86% 62%, var(--glow-2), transparent 26%);
    pointer-events: none;
    filter: blur(60px);
    opacity: 0.8;
}

/* ============================================
   PERFORMANCE MODE (reduce expensive effects)
   Enabled via: <body class="perf-mode"> (also applied to <html> early)
   ============================================ */
:root.perf-mode body *,
:root.perf-mode body *::before,
:root.perf-mode body *::after,
body.perf-mode *,
body.perf-mode *::before,
body.perf-mode *::after {
    backdrop-filter: none !important;
}

:root.perf-mode .app-shell::before,
body.perf-mode .app-shell::before {
    filter: none !important;
    opacity: 0 !important;
}

:root.perf-mode .context-menu,
:root.perf-mode .routines-context-menu,
:root.perf-mode .ctx-submenu,
:root.perf-mode .toast,
:root.perf-mode .connections-panel,
:root.perf-mode .prompt-dialog,
body.perf-mode .context-menu,
body.perf-mode .routines-context-menu,
body.perf-mode .ctx-submenu,
body.perf-mode .toast,
body.perf-mode .connections-panel,
body.perf-mode .prompt-dialog {
    box-shadow: none !important;
}

:root.perf-mode .btn:hover,
body.perf-mode .btn:hover {
    transform: none !important;
    box-shadow: none !important;
}

.menu-bar {
    display: flex;
    align-items: center;
    gap: 16px;
    justify-content: space-between;
    padding: 0 14px;
    height: 40px;
    border-bottom: 1px solid #323232;
    background: #3c3f41 !important;
    position: relative;
    z-index: 100;
}

.menu-left,
.menu-right {
    display: flex;
    align-items: center;
    gap: 12px;
}

.menu-right {
    min-width: 24px;
}

.menu-cluster {
    display: flex;
    align-items: center;
    gap: 8px;
}

.menu-item {
    position: relative;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    color: var(--text);
    font-size: 13px;
    font-weight: 500;
}

.menu-item:hover,
.menu-item.open {
    background: var(--hover-bg);
}

.menu-dropdown {
    position: absolute;
    top: 28px;
    left: 0;
    display: grid;
    gap: 2px;
    padding: 4px;
    min-width: 180px;
    background: var(--panel-strong);
    border: 1px solid var(--border);
    border-radius: 6px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
    opacity: 0;
    pointer-events: none;
    transform: translateY(-4px);
    transition: all 0.12s ease;
    z-index: 200;
}

.menu-item.open .menu-dropdown,
.menu-item:hover .menu-dropdown {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}

.menu-separator {
    height: 1px;
    background: var(--border);
    margin: 4px 6px;
}

.menu-action {
    background: transparent;
    border: none;
    border-radius: 4px;
    padding: 6px 10px;
    color: var(--text);
    text-align: left;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
}

.menu-action:hover {
    background: var(--hover-bg);
    border-color: var(--accent-blue);
}

.menu-action:disabled {
    opacity: 0.5;
    cursor: default;
}

.theme-switcher {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #2d2f30 !important;
    border: 1px solid #323232;
    padding: 6px 8px;
    border-radius: 10px;
    font-size: 12px;
    color: #808080 !important;
}

.theme-switcher select {
    background: transparent;
    border: none;
    color: var(--text);
    font-weight: 600;
    outline: none;
}

.theme-switcher label {
    color: var(--muted);
    font-weight: 600;
}
